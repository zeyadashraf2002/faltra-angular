<!-- ğŸ“ subscription-dashboard.component.html - MODERN MINIMALIST -->
<div class="dashboard-container" dir="rtl">
  
  <!-- Top Navigation Bar -->
  <nav class="dashboard-nav">
    <div class="nav-content">
      <div class="nav-brand">
        <img src="assets/logo.png" alt="ÙÙ„ØªØ±Ù‡" class="nav-logo-img">
        <div>
          <h5>ÙÙ„ØªØ±Ù‡</h5>
          <small>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</small>
        </div>
      </div>
      
      <div class="nav-actions">
        <button class="btn-companies" (click)="goToCompanies()">
          <i class="bi bi-buildings"></i>
          <span>Ø§Ù„Ø´Ø±ÙƒØ§Øª</span>
        </button>
        <button class="btn-logout" (click)="logout()">
          <i class="bi bi-box-arrow-left"></i>
          <span>Ø®Ø±ÙˆØ¬</span>
        </button>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="dashboard-main">
    <div class="container-fluid">
      
      <!-- Page Header -->
      <div class="page-header">
        <div>
          <h1>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</h1>
          <p>Ù†Ø¸Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ø¹Ù„Ù‰ Ø¯Ø®Ù„ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ÙˆØ§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©</p>
        </div>
      </div>

      <!-- Filters -->
      <div class="filters-section">
        <div class="filter-group">
          <label>
            <i class="bi bi-calendar-month"></i>
            Ø§Ù„Ø´Ù‡Ø±
          </label>
          <select [(ngModel)]="selectedMonth" (change)="onMonthChange()" class="form-select">
            <option [value]="1">ÙŠÙ†Ø§ÙŠØ±</option>
            <option [value]="2">ÙØ¨Ø±Ø§ÙŠØ±</option>
            <option [value]="3">Ù…Ø§Ø±Ø³</option>
            <option [value]="4">Ø£Ø¨Ø±ÙŠÙ„</option>
            <option [value]="5">Ù…Ø§ÙŠÙˆ</option>
            <option [value]="6">ÙŠÙˆÙ†ÙŠÙˆ</option>
            <option [value]="7">ÙŠÙˆÙ„ÙŠÙˆ</option>
            <option [value]="8">Ø£ØºØ³Ø·Ø³</option>
            <option [value]="9">Ø³Ø¨ØªÙ…Ø¨Ø±</option>
            <option [value]="10">Ø£ÙƒØªÙˆØ¨Ø±</option>
            <option [value]="11">Ù†ÙˆÙÙ…Ø¨Ø±</option>
            <option [value]="12">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label>
            <i class="bi bi-calendar"></i>
            Ø§Ù„Ø³Ù†Ø©
          </label>
          <select [(ngModel)]="selectedYear" (change)="onYearChange()" class="form-select">
            @for (year of availableYears; track year) {
              <option [value]="year">{{ year }}</option>
            }
          </select>
        </div>
      </div>

      <!-- Loading State -->
      @if (isLoading) {
        <div class="loading-state">
          <div class="spinner"></div>
          <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...</p>
        </div>
      }

      <!-- Stats Cards -->
      @if (!isLoading && stats) {
        <div class="stats-grid">
          
          <!-- Monthly Revenue -->
          <div class="stat-card">
            <div class="stat-icon revenue">
              <i class="bi bi-cash-stack"></i>
            </div>
            <div class="stat-content">
              <label>Ø¯Ø®Ù„ {{ stats.period.monthName }}</label>
              <h2>{{ formatCurrency(stats.monthly.revenue) }}</h2>
              <span class="stat-meta">{{ stats.monthly.invoicesCount }} ÙØ§ØªÙˆØ±Ø©</span>
            </div>
          </div>

          <!-- Yearly Revenue -->
          <div class="stat-card">
            <div class="stat-icon yearly">
              <i class="bi bi-graph-up-arrow"></i>
            </div>
            <div class="stat-content">
              <label>Ø¯Ø®Ù„ Ø§Ù„Ø³Ù†Ø© {{ stats.period.year }}</label>
              <h2>{{ formatCurrency(stats.yearly.revenue) }}</h2>
              <span class="stat-meta">{{ stats.yearly.invoicesCount }} ÙØ§ØªÙˆØ±Ø©</span>
            </div>
          </div>

          <!-- Active Subscriptions -->
          <div class="stat-card">
            <div class="stat-icon active">
              <i class="bi bi-check-circle"></i>
            </div>
            <div class="stat-content">
              <label>Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ù†Ø´Ø·Ø©</label>
              <h2>{{ stats.subscriptions.active }}</h2>
              <span class="stat-meta">Ø´Ø±ÙƒØ© Ù…Ø´ØªØ±ÙƒØ©</span>
            </div>
          </div>

          <!-- Trial Companies -->
          <div class="stat-card">
            <div class="stat-icon trial">
              <i class="bi bi-hourglass-split"></i>
            </div>
            <div class="stat-content">
              <label>Ø´Ø±ÙƒØ§Øª ÙÙŠ ÙØªØ±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</label>
              <h2>{{ stats.subscriptions.trial }}</h2>
              <span class="stat-meta">Ø´Ø±ÙƒØ©</span>
            </div>
          </div>

        </div>

        <!-- Monthly Revenue Chart -->
        @if (yearlyReport) {
          <div class="chart-section">
            <div class="section-header">
              <h3>
                <i class="bi bi-bar-chart-line"></i>
                ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø´Ù‡Ø± Ù„Ø³Ù†Ø© {{ yearlyReport.year }}
              </h3>
              <div class="total-badge">
                Ø¥Ø¬Ù…Ø§Ù„ÙŠ: {{ formatCurrency(yearlyReport.totalRevenue) }}
              </div>
            </div>
            
            <!-- Modern Table with Visual Bars -->
            <div class="revenue-table">
              <table>
                <thead>
                  <tr>
                    <th>Ø§Ù„Ø´Ù‡Ø±</th>
                    <th>Ø§Ù„Ø¯Ø®Ù„</th>
                    <th>Ø§Ù„ÙÙˆØ§ØªÙŠØ±</th>
                    <th>Ø§Ù„ØªÙ‚Ø¯Ù…</th>
                  </tr>
                </thead>
                <tbody>
                  @for (month of yearlyReport.months; track month.month) {
                    <tr [class.current]="month.month === selectedMonth">
                      <td class="month-name">{{ month.monthName }}</td>
                      <td class="revenue">{{ formatCurrency(month.revenue) }}</td>
                      <td class="invoices">{{ month.invoicesCount }}</td>
                      <td class="progress-cell">
                        <div class="progress-bar">
                          <div 
                            class="progress-fill" 
                            [style.width.%]="getProgressPercentage(month.revenue, yearlyReport.totalRevenue)">
                          </div>
                        </div>
                        <span class="percentage">{{ getProgressPercentage(month.revenue, yearlyReport.totalRevenue) }}%</span>
                      </td>
                    </tr>
                  }
                </tbody>
                <tfoot>
                  <tr>
                    <td><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</strong></td>
                    <td><strong>{{ formatCurrency(yearlyReport.totalRevenue) }}</strong></td>
                    <td><strong>{{ getTotalInvoices(yearlyReport.months) }}</strong></td>
                    <td></td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        }

        <!-- Recent Subscriptions -->
        <div class="recent-section">
          <div class="section-header">
            <h3>
              <i class="bi bi-clock-history"></i>
              Ø£Ø­Ø¯Ø« Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
            </h3>
          </div>

          @if (stats.recent.length === 0) {
            <div class="empty-state">
              <i class="bi bi-inbox"></i>
              <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø­Ø¯ÙŠØ«Ø©</p>
            </div>
          }

          @if (stats.recent.length > 0) {
            <div class="subscriptions-table">
              <table>
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Ø§Ù„Ø´Ø±ÙƒØ©</th>
                    <th>Ø§Ù„Ø¨Ø§Ù‚Ø©</th>
                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡</th>
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                  </tr>
                </thead>
                <tbody>
                  @for (sub of stats.recent; track sub.id) {
                    <tr>
                      <td>#{{ sub.id }}</td>
                      <td>
                        <div class="company-info">
                          <strong>{{ sub.company.name }}</strong>
                          <small>{{ sub.company.email }}</small>
                        </div>
                      </td>
                      <td>{{ sub.plan.nameAr }}</td>
                      <td class="amount">{{ formatCurrency(sub.plan.price) }}</td>
                      <td class="date">{{ sub.startDate | date: 'dd/MM/yyyy' }}</td>
                      <td class="date">{{ sub.endDate | date: 'dd/MM/yyyy' }}</td>
                      <td>
                        <span class="badge" [ngClass]="getStatusBadgeClass(sub.status)">
                          {{ getStatusText(sub.status) }}
                        </span>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          }
        </div>
      }

    </div>
  </div>
</div>