<!-- ğŸ“ src/app/components/company-details/company-details.component.html -->
<div class="company-details-container" dir="rtl">
  
  <!-- Loading State -->
  @if (isLoading) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´Ø±ÙƒØ©...</p>
    </div>
  }

  <!-- Error State -->
  @if (error && !isLoading) {
    <div class="error-state">
      <i class="bi bi-exclamation-triangle"></i>
      <h3>Ø­Ø¯Ø« Ø®Ø·Ø£</h3>
      <p>{{ error }}</p>
      <button class="btn-back" (click)="goBack()">
        <i class="bi bi-arrow-right"></i>
        Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø´Ø±ÙƒØ§Øª
      </button>
    </div>
  }

  <!-- Content -->
  @if (subscriptionStatus && !isLoading) {
    <div class="content-wrapper">
      
      <!-- Header -->
      <div class="page-header">
        <button class="btn-back-small" (click)="goBack()">
          <i class="bi bi-arrow-right"></i>
          Ø¹ÙˆØ¯Ø©
        </button>
        <div class="header-content">
          <i class="bi bi-building"></i>
          <div>
            <h1>{{ subscriptionStatus.company.name }}</h1>
            <p>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ±</p>
          </div>
        </div>
      </div>

      <!-- Status Card -->
      <div class="status-card">
        <div class="status-header">
          <h2>
            <i class="bi bi-calendar-check"></i>
            Ø­Ø§Ù„Ø© Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø´Ø±ÙƒØ©
          </h2>
          <span 
            class="status-badge" 
            [ngClass]="getStatusBadgeClass(subscriptionStatus.status)">
            {{ getStatusText(subscriptionStatus.status) }}
          </span>
        </div>

        <div class="status-body">
          
          <!-- Company Info -->
          <div class="info-card">
            <div class="info-icon">
              <i class="bi bi-building-fill"></i>
            </div>
            <div class="info-content">
              <label>Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</label>
              <span>{{ subscriptionStatus.company.name }}</span>
            </div>
          </div>

          <!-- Current Subscription -->
          @if (subscriptionStatus.currentSubscription) {
            <div class="subscription-grid">
              
              <!-- Current Plan -->
              <div class="info-card highlight">
                <div class="info-icon success">
                  <i class="bi bi-award-fill"></i>
                </div>
                <div class="info-content">
                  <label>Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                  <span class="plan-name">{{ subscriptionStatus.currentSubscription.plan.nameAr }}</span>
                </div>
              </div>

              <!-- Expiry Date -->
              <div class="info-card">
                <div class="info-icon">
                  <i class="bi bi-calendar-x"></i>
                </div>
                <div class="info-content">
                  <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label>
                  <span>{{ subscriptionStatus.expiryDate | date: 'dd/MM/yyyy' }}</span>
                </div>
              </div>

              <!-- Days Remaining -->
              <div class="info-card">
                <div class="info-icon">
                  <i class="bi bi-hourglass-split"></i>
                </div>
                <div class="info-content">
                  <label>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</label>
                  <span [ngClass]="getDaysRemainingClass()" class="days-count">
                    {{ subscriptionStatus.daysRemaining }} ÙŠÙˆÙ…
                  </span>
                </div>
              </div>

            </div>
          }

          <!-- No Active Subscription -->
          @if (!subscriptionStatus.currentSubscription) {
            <div class="no-subscription">
              <i class="bi bi-x-circle"></i>
              <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø´ØªØ±Ø§Ùƒ Ù†Ø´Ø· Ø­Ø§Ù„ÙŠØ§Ù‹</p>
            </div>
          }

          <!-- Status Alert -->
          @if (subscriptionStatus.status === 'expired') {
            <div class="alert alert-danger">
              <i class="bi bi-exclamation-triangle-fill"></i>
              <div>
                <strong>Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ù…Ù†ØªÙ‡ÙŠ</strong>
                <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª</p>
              </div>
            </div>
          }

          @if (subscriptionStatus.daysRemaining <= 7 && subscriptionStatus.daysRemaining > 0) {
            <div class="alert alert-warning">
              <i class="bi bi-bell-fill"></i>
              <div>
                <strong>ØªÙ†Ø¨ÙŠÙ‡</strong>
                <p>Ø§Ø´ØªØ±Ø§ÙƒÙƒ ÙŠÙ†ØªÙ‡ÙŠ Ø®Ù„Ø§Ù„ {{ subscriptionStatus.daysRemaining }} Ø£ÙŠØ§Ù…</p>
              </div>
            </div>
          }

        </div>
      </div>
<!-- ==========================================
     ğŸ†• NEW: Subscription History Section
     ========================================== -->
<div class="subscriptions-section">
  <div class="section-header">
    <h2>
      <i class="bi bi-clock-history"></i>
      Ø³Ø¬Ù„ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
    </h2>
    @if (subscriptionStatus.subscriptionHistory.length > 0) {
      <span class="count-badge">{{ subscriptionStatus.subscriptionHistory.length }}</span>
    }
  </div>

  @if (subscriptionStatus.subscriptionHistory.length === 0) {
    <div class="empty-state">
      <i class="bi bi-inbox"></i>
      <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</p>
    </div>
  }

  @if (subscriptionStatus.subscriptionHistory.length > 0) {
    <div class="subscriptions-table-wrapper">
      <table class="subscriptions-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Ø§Ù„Ø¨Ø§Ù‚Ø©</th>
            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</th>
            <th>Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</th>
          </tr>
        </thead>
        <tbody>
          @for (subscription of subscriptionStatus.subscriptionHistory; track subscription.id) {
            <tr>
              <td class="subscription-id">#{{ subscription.id }}</td>
              <td class="plan-name-ar">{{ subscription.plan.nameAr }}</td>
              <td>
                <span 
                  class="badge"
                  [ngClass]="getSubscriptionStatusBadge(subscription.status)">
                  {{ getSubscriptionStatusText(subscription.status) }}
                </span>
              </td>
              <td class="date">
                {{ subscription.startDate | date: 'dd/MM/yyyy' }}
              </td>
              <td class="date">
                {{ subscription.endDate | date: 'dd/MM/yyyy' }}
              </td>
              <td class="text-center">
                @if (subscription.autoRenew) {
                  <i class="bi bi-check-circle-fill text-success" title="Ù…ÙØ¹Ù„"></i>
                } @else {
                  <i class="bi bi-x-circle-fill text-danger" title="ØºÙŠØ± Ù…ÙØ¹Ù„"></i>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>
      <!-- Invoices Section -->
      <div class="invoices-section">
        <div class="section-header">
          <h2>
            <i class="bi bi-receipt"></i>
            Ø³Ø¬Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
          </h2>
          @if (subscriptionStatus.invoices.length > 0) {
            <span class="count-badge">{{ subscriptionStatus.invoices.length }}</span>
          }
        </div>

        @if (subscriptionStatus.invoices.length === 0) {
          <div class="empty-state">
            <i class="bi bi-inbox"></i>
            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
          </div>
        }

        @if (subscriptionStatus.invoices.length > 0) {
          <div class="invoices-table-wrapper">
            <table class="invoices-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>ğŸ†• ID Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th> 
                  <th>Ø§Ù„Ø¨Ø§Ù‚Ø©</th>
                  <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                  <th>Ø§Ù„Ù…Ø¯Ø©</th>
                  <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
                  <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                  <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                </tr>
              </thead>
              <tbody>
                @for (invoice of subscriptionStatus.invoices; track invoice.id) {
                  <tr>
                    <td class="invoice-id">#{{ invoice.id }}</td>
                     <td class="subscription-id">
          @if (invoice.subscriptionId) {
            <span class="sub-id-badge">#{{ invoice.subscriptionId }}</span>
          } @else {
            <span class="text-muted">-</span>
          }
        </td>
                    <td class="plan-name">{{ invoice.planName }}</td>
                    <td class="amount">
                      <strong>{{ invoice.amount }}</strong> Ø¬Ù†ÙŠÙ‡
                    </td>
                    <td>{{ invoice.durationDays }} ÙŠÙˆÙ…</td>
                    <td>
                      <div class="payment-method">
                        <i [class]="getPaymentMethodIcon(invoice.paymentMethod)"></i>
                        <span>{{ getPaymentMethodText(invoice.paymentMethod) }}</span>
                      </div>
                    </td>
                    <td>
                      <span 
                        class="badge"
                        [ngClass]="getPaymentStatusBadge(invoice.paymentStatus).class">
                        {{ getPaymentStatusBadge(invoice.paymentStatus).text }}
                      </span>
                    </td>
                    <td class="date">
                      {{ (invoice.paidAt || invoice.createdAt) | date: 'dd/MM/yyyy' }}
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        }
      </div>

    </div>
  }

</div>